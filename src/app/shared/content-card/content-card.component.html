<article class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300">
  <header class="relative flex flex-col md:flex-row">
    <div class="relative md:w-1/2">
      <img
        [src]="safeContent().imageUrl"
        [alt]="safeContent().alt"
        [attr.aria-label]="safeContent().aria"
        class="w-full h-64 md:h-full object-cover transition-transform duration-300 hover:scale-105"
      >
      <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
        <h2 class="text-2xl text-white font-bold">{{ safeContent().name }}</h2>
      </div>
    </div>

    <div class="p-6 md:w-1/2 flex items-center bg-gray-50">
      <p class="text-gray-700 leading-relaxed">{{ safeContent().description }}</p>
    </div>
  </header>

  <div class="p-6 space-y-6">
  <ng-container [ngSwitch]="contentType()">

    <!-- Pour les races -->
    <div *ngSwitchCase="'race'" class="space-y-6">
      <!-- Détails de base -->
      <ng-container *ngIf="getRaceContent() as raceContent">
        <!-- Détails généraux -->
        <div *ngIf="raceContent.details?.length" class="mb-6">
          <h3 class="text-xl font-bold text-primary-700 mb-4">Détails</h3>
          <div class="space-y-4">
            <div *ngFor="let detail of raceContent.details"
                 class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors duration-200">
              <h4 class="text-lg font-semibold mb-2 text-primary-600">
                {{ detail.name }}
              </h4>
              <p class="text-gray-700 leading-relaxed">
                {{ detail.content }}
              </p>
            </div>
          </div>
        </div>

        <!-- Traits raciaux -->
        <div *ngIf="raceContent.traits?.length" class="mb-6">
          <h3 class="text-xl font-bold text-primary-700 mb-4">Traits raciaux</h3>
          <div class="space-y-4">
            <div *ngFor="let trait of raceContent.traits"
                 class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors duration-200">
              <h4 class="text-lg font-semibold mb-2 text-primary-600">
                {{ trait.name }}
              </h4>
              <p class="text-gray-700 leading-relaxed">
                {{ trait.description }}
              </p>
            </div>
          </div>
        </div>

        <!-- Sous-races -->
        <div *ngIf="raceContent.sub_races" class="mb-6">
          <h3 class="text-xl font-bold text-primary-700 mb-4">{{ raceContent.sub_races.title }}</h3>
          <p class="text-gray-700 mb-4">{{ raceContent.sub_races.description }}</p>

          <div class="space-y-4">
            <div *ngFor="let choice of raceContent.sub_races.choices"
                 class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors duration-200">
              <h4 class="text-lg font-semibold mb-2 text-primary-600">
                {{ choice.name }}
              </h4>
              <p class="text-gray-700 mb-3">{{ choice.description }}</p>

              <div *ngIf="choice.bonuses?.length" class="pl-4 border-l-4 border-primary-200">
                <h5 class="text-md font-medium text-primary-600 mb-2">Bonus</h5>
                <div *ngFor="let bonus of choice.bonuses" class="mb-2">
                  <p class="font-medium text-gray-800">{{ bonus.name }}</p>
                  <p class="text-gray-700">{{ bonus.description }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Table d'ascendance (pour les races comme les Dragonborn) -->
        <div *ngIf="raceContent.ancestry_table?.length" class="mb-6">
          <h3 class="text-xl font-bold text-primary-700 mb-4">Table d'ascendance</h3>
          <div class="overflow-x-auto">
            <table class="min-w-full bg-white border border-gray-200">
              <thead class="bg-gray-50">
              <tr>
                <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Nom</th>
                <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Type de dégâts</th>
                <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Souffle</th>
              </tr>
              </thead>
              <tbody class="divide-y divide-gray-200">
              <tr *ngFor="let element of raceContent.ancestry_table" class="hover:bg-gray-50">
                <td class="px-4 py-2 text-sm text-gray-700">{{ element.name }}</td>
                <td class="px-4 py-2 text-sm text-gray-700">{{ element.damage_type }}</td>
                <td class="px-4 py-2 text-sm text-gray-700">{{ element.breath }}</td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </ng-container>
    </div>


    <!-- Pour les backgrounds -->
    <div *ngSwitchCase="'background'" class="space-y-6">
      <ng-container *ngIf="getBackgroundContent() as bgContent">
        <!-- Informations de base -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div *ngIf="bgContent.starting_proficiencies" class="bg-gray-50 rounded-lg p-4">
            <h3 class="text-lg font-semibold text-primary-600 mb-2">Maîtrises de départ</h3>
            <p class="text-gray-700">{{ bgContent.starting_proficiencies }}</p>
          </div>

          <div *ngIf="bgContent.mastered_tools" class="bg-gray-50 rounded-lg p-4">
            <h3 class="text-lg font-semibold text-primary-600 mb-2">Outils maîtrisés</h3>
            <p class="text-gray-700">{{ bgContent.mastered_tools }}</p>
          </div>

          <div *ngIf="bgContent.language_options" class="bg-gray-50 rounded-lg p-4">
            <h3 class="text-lg font-semibold text-primary-600 mb-2">Options de langues</h3>
            <p class="text-gray-700">{{ bgContent.language_options }} langues supplémentaires au choix</p>
          </div>
        </div>

        <!-- Équipement -->
        <div *ngIf="bgContent.starting_equipment" class="bg-gray-50 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-primary-600 mb-2">Équipement de départ</h3>
          <p class="text-gray-700">{{ bgContent.starting_equipment }}</p>
        </div>

        <!-- Traits de personnalité -->
        <div *ngIf="bgContent.personality_traits" class="bg-gray-50 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-primary-600 mb-3">
            Traits de personnalité (choisissez-en {{ bgContent.personality_traits.choose }})
          </h3>
          <ul class="space-y-2">
            <li *ngFor="let trait of bgContent.personality_traits.from"
                class="flex items-start">
          <span class="inline-block w-6 h-6 bg-primary-100 text-primary-600 rounded-full text-center mr-2">
            {{ trait.id }}
          </span>
              <span class="text-gray-700">{{ trait.string }}</span>
            </li>
          </ul>
        </div>

        <!-- Idéaux -->
        <div *ngIf="bgContent.ideals" class="bg-gray-50 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-primary-600 mb-3">
            Idéaux (choisissez-en {{ bgContent.ideals.choose }})
          </h3>
          <ul class="space-y-2">
            <li *ngFor="let ideal of bgContent.ideals.from"
                class="flex items-start">
          <span class="inline-block w-6 h-6 bg-primary-100 text-primary-600 rounded-full text-center mr-2">
            {{ ideal.id }}
          </span>
              <span class="text-gray-700">{{ ideal.string }}</span>
            </li>
          </ul>
        </div>

        <!-- Liens -->
        <div *ngIf="bgContent.bonds" class="bg-gray-50 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-primary-600 mb-3">
            Liens (choisissez-en {{ bgContent.bonds.choose }})
          </h3>
          <ul class="space-y-2">
            <li *ngFor="let bond of bgContent.bonds.from"
                class="flex items-start">
          <span class="inline-block w-6 h-6 bg-primary-100 text-primary-600 rounded-full text-center mr-2">
            {{ bond.id }}
          </span>
              <span class="text-gray-700">{{ bond.string }}</span>
            </li>
          </ul>
        </div>

        <!-- Défauts -->
        <div *ngIf="bgContent.flaws" class="bg-gray-50 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-primary-600 mb-3">
            Défauts (choisissez-en {{ bgContent.flaws.choose }})
          </h3>
          <ul class="space-y-2">
            <li *ngFor="let flaw of bgContent.flaws.from"
                class="flex items-start">
          <span class="inline-block w-6 h-6 bg-primary-100 text-primary-600 rounded-full text-center mr-2">
            {{ flaw.id }}
          </span>
              <span class="text-gray-700">{{ flaw.string }}</span>
            </li>
          </ul>
        </div>

        <!-- Aptitude spéciale -->
        <div *ngIf="bgContent.feature" class="bg-gray-50 rounded-lg p-4">
          <h3 class="text-lg font-semibold text-primary-600 mb-2">
            {{ bgContent.feature.name }}
          </h3>
          <p class="text-gray-700">{{ bgContent.feature.description }}</p>

          <!-- Affichage des choix d'aptitude si disponibles -->
          <div *ngIf="bgContent.feature.choices && bgContent.feature.choices.length > 0" class="mt-3">
            <h4 class="text-md font-medium text-primary-600 mb-2">Spécialités</h4>
            <ul class="space-y-1">
              <li *ngFor="let choice of bgContent.feature.choices" class="text-gray-700">
                <span class="font-medium">{{ choice.index }}.</span> {{ choice.background_speciality }}
              </li>
            </ul>
          </div>
        </div>
      </ng-container>
    </div>



    <!-- Pour les classes -->
      <div *ngSwitchCase="'class'" class="space-y-6">
        <ng-container *ngIf="getClassContent() as classContent">
          <!-- Trait caractéristique -->
          <div *ngIf="classContent.trait && classContent.trait_description" class="bg-gray-50 rounded-lg p-4">
            <h3 class="text-lg font-semibold text-primary-600 mb-2">{{ classContent.trait }}</h3>
            <p class="text-gray-700">{{ classContent.trait_description }}</p>
          </div>

          <!-- Principes de classe -->
          <div *ngIf="classContent.class_principles && classContent.class_principles_description" class="bg-gray-50 rounded-lg p-4">
            <h3 class="text-lg font-semibold text-primary-600 mb-2">{{ classContent.class_principles }}</h3>
            <p class="text-gray-700">{{ classContent.class_principles_description }}</p>
          </div>

          <!-- Création de personnage -->
          <div *ngIf="classContent.create && classContent.create_description" class="bg-gray-50 rounded-lg p-4">
            <h3 class="text-lg font-semibold text-primary-600 mb-2">{{ classContent.create }}</h3>
            <p class="text-gray-700">{{ classContent.create_description }}</p>
            <p *ngIf="classContent.create_fast" class="text-gray-700 mt-2 italic">{{ classContent.create_fast }}</p>
          </div>

          <!-- Capacités de classe -->
          <div *ngIf="classContent.class_abilities" class="space-y-6">
            <img
              *ngIf="classContent.alt_abilities && classContent.class_abilities.leveling_table"
              [src]="classContent.class_abilities.leveling_table"
              [alt]="classContent.alt_abilities"
              class="w-full rounded-lg shadow-md"
            >

            <!-- Santé -->
            <div *ngIf="classContent.class_abilities.health" class="bg-gray-50 rounded-lg p-4">
              <h3 class="text-xl font-semibold mb-3 text-primary-600">Points de vie</h3>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <h4 class="font-medium text-primary-700">Dés de vie</h4>
                  <p class="text-gray-700">{{ classContent.class_abilities.health.hit_dice }}</p>
                </div>
                <div>
                  <h4 class="font-medium text-primary-700">Points de vie au niveau 1</h4>
                  <p class="text-gray-700">{{ classContent.class_abilities.health.health_at_lvl_1 }}</p>
                </div>
                <div>
                  <h4 class="font-medium text-primary-700">Points de vie aux niveaux supérieurs</h4>
                  <p class="text-gray-700">{{ classContent.class_abilities.health.health_by_lvl }}</p>
                </div>
              </div>
            </div>

            <!-- Maîtrises -->
            <div *ngIf="classContent.class_abilities.masteries" class="bg-gray-50 rounded-lg p-4">
              <h3 class="text-xl font-semibold mb-3 text-primary-600">Maîtrises</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <h4 class="font-medium text-primary-700">Armures</h4>
                  <p class="text-gray-700">{{ classContent.class_abilities.masteries.armors }}</p>
                </div>
                <div>
                  <h4 class="font-medium text-primary-700">Armes</h4>
                  <p class="text-gray-700">{{ classContent.class_abilities.masteries.weapons }}</p>
                </div>
                <div>
                  <h4 class="font-medium text-primary-700">Outils</h4>
                  <p class="text-gray-700">{{ classContent.class_abilities.masteries.tools }}</p>
                </div>
                <div>
                  <h4 class="font-medium text-primary-700">Jets de sauvegarde</h4>
                  <p class="text-gray-700">{{ classContent.class_abilities.masteries.saving_throws }}</p>
                </div>
                <div>
                  <h4 class="font-medium text-primary-700">Compétences</h4>
                  <p class="text-gray-700">{{ classContent.class_abilities.masteries.skills }}</p>
                </div>
              </div>
            </div>

            <!-- Équipement -->
            <div *ngIf="classContent.class_abilities.equipment" class="bg-gray-50 rounded-lg p-4">
              <h3 class="text-xl font-semibold mb-3 text-primary-600">Équipement</h3>
              <p class="text-gray-700 mb-3">{{ classContent.class_abilities.equipment.description }}</p>
              <div class="space-y-2">
                <div *ngFor="let choice of classContent.class_abilities.equipment.choices; let i = index"
                     class="flex items-start">
            <span class="inline-block w-6 h-6 bg-primary-100 text-primary-600 rounded-full text-center mr-2">
              {{ i + 1 }}
            </span>
                  <span class="text-gray-700">{{ choice }}</span>
                </div>
              </div>
            </div>

            <!-- Capacités -->
            <div *ngIf="classContent.class_abilities.abilities?.length" class="bg-gray-50 rounded-lg p-4">
              <h3 class="text-xl font-semibold mb-3 text-primary-600">Capacités de classe</h3>
              <div *ngFor="let ability of classContent.class_abilities.abilities" class="mb-4 last:mb-0">
                <h4 class="font-medium text-primary-700 mb-1">{{ ability.name }}</h4>
                <p class="text-gray-700">{{ ability.description }}</p>
              </div>
            </div>

            <!-- Spécialisation -->
            <div *ngIf="classContent.class_abilities.specialization" class="space-y-4">
              <h3 class="text-xl font-semibold text-primary-600">Spécialisation</h3>
              <div class="bg-gray-50 rounded-lg p-4">
                <h4 class="text-lg font-semibold text-primary-700 mb-2">{{ classContent.class_abilities.specialization.name }}</h4>
                <p class="text-gray-700 mb-4">{{ classContent.class_abilities.specialization.description }}</p>

                <div *ngIf="classContent.class_abilities.specialization.choices?.length" class="space-y-4 mt-4">
                  <div *ngFor="let choice of classContent.class_abilities.specialization.choices; let i = index"
                       class="border border-primary-200 rounded-lg overflow-hidden">
                    <!-- En-tête du déroulant (toujours visible) -->
                    <button
                      (click)="toggleSpecChoice(i)"
                      class="w-full flex justify-between items-center p-4 bg-primary-50 hover:bg-primary-100 transition-colors text-left"
                      [attr.aria-expanded]="isSpecChoiceOpen(i)"
                      [attr.aria-controls]="'spec-choice-' + i">
                      <h5 class="font-medium text-primary-600">{{ choice.name }}</h5>
                      <svg
                        class="w-5 h-5 transition-transform transform"
                        [ngClass]="{'rotate-180': isSpecChoiceOpen(i)}"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                      </svg>
                    </button>

                    <!-- Contenu du déroulant (visible uniquement lorsqu'il est ouvert) -->
                    <div
                      id="'spec-choice-' + i"
                      class="p-4 bg-white transition-all overflow-hidden"
                      [ngClass]="{'hidden': !isSpecChoiceOpen(i), 'block': isSpecChoiceOpen(i)}">
                      <p class="text-gray-700 mb-3">{{ choice.description }}</p>

                      <div *ngIf="choice.abilities?.length" class="space-y-3 mt-3">
                        <div *ngFor="let ability of choice.abilities" class="border-l-4 border-primary-300 pl-4 py-2">
                          <h6 class="font-medium text-primary-500">{{ ability.name }}</h6>
                          <p class="text-gray-700">{{ ability.description }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>

          <!-- Tables supplémentaires -->
          <div *ngIf="classContent.tables?.length" class="space-y-4">
            <div *ngFor="let table of classContent.tables" class="bg-gray-50 rounded-lg p-4">
              <h3 class="text-lg font-semibold text-primary-600 mb-3">{{ table.name }}</h3>
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-100">
                  <tr>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valeur</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Effet</th>
                  </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                  <tr *ngFor="let choice of table.choices">
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-700">{{ choice.value }}</td>
                    <td class="px-4 py-2 text-sm text-gray-700">{{ choice.effect }}</td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </ng-container>
  </div>
</article>
